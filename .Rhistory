xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 6, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 16, face = "italic"),
axis.title.x = element_text(size = 16),
axis.title.y = element_text(size = 16)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 160       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 8  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 6, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 18, face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 160       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 8  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 10, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 160       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 8  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 12, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 160       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 8  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 11, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 160       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 8  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 11, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 600, height = 400, res = 500, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 160       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 8  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 11, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 20, face = "bold"),
plot.subtitle = element_text(size = 14, face = "italic"),
axis.title.x = element_text(size = 14),
axis.title.y = element_text(size = 14)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 5, width = 1400, height = 865, res = 200, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 150       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 8  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 11, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 12, face = "italic"),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 2, width = 1400, height = 865, res = 200, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 150       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 7  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 11, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 12, face = "italic"),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 4, width = 1400, height = 865, res = 200, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 150       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 6.5  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 13, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 12, face = "italic"),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 4, width = 1400, height = 865, res = 200, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
# Set parameters
set.seed(60424)   # For reproducibility
n <- 150       # Number of points
true_mean <- 50 # Constant mean
true_sd <- 10   # Standard deviation
bin_width <- 2  # Histogram bin width
circle_size <- 6.3  # Adjusted circle size
circle_diameter <- .5  # Adjust vertical spacing
# Simulate data
data <- data.frame(value = rnorm(n, mean = true_mean, sd = true_sd))
# Bin data into histogram-style bins
data <- data %>%
mutate(bin = cut(value, breaks = seq(min(value), max(value), by = bin_width), labels = FALSE)) %>%
group_by(bin) %>%
mutate(stack_pos = row_number() * circle_diameter) %>%  # Correct stacking
ungroup() %>%
mutate(frame = row_number())  # Frame number to animate appearance
# Define bin centers for correct x-axis alignment
bin_centers <- seq(min(data$value), max(data$value), by = bin_width) + bin_width / 2
data$bin_center <- bin_centers[data$bin]
# Determine the max stack height for a fixed y-axis
max_stack_height <- max(data$stack_pos)
# Create animated plot
p <- ggplot(data, aes(x = bin_center, y = stack_pos)) +
geom_point(size = circle_size, shape = 21, fill = "white", color = "black") +
geom_vline(xintercept = true_mean, color = "red", linetype = "dashed", size = 1) +
annotate("text", x = true_mean + 13, y = max(data$stack_pos) * 0.9,
label = "True treatment effect = 50", color = "red", size = 5, fontface = "bold") +
theme_minimal() +
xlim(20,80) +
labs(x = "Estimates of the Treatment Effect",
y = "Number of Estimate Replications ") +
ggtitle('Treatment effect estimate if study was replicated {closest_state} times',
subtitle = 'With random assignment the estimator is unbiased (the long run average)') +
theme(
plot.title = element_text(size = 16, face = "bold"),
plot.subtitle = element_text(size = 12, face = "italic"),
axis.title.x = element_text(size = 12),
axis.title.y = element_text(size = 12)) +
transition_states(frame, transition_length = 0.1, state_length = 0.1) +  # Animate point appearances
shadow_mark(alpha = 1)  # Keep previous points visible
# Render and save animation
animated_histogram <- animate(p, nframes = n, fps = 4, width = 1400, height = 865, res = 200, renderer = gifski_renderer())
# Save GIF
anim_save("stacked_circle_histogram.gif", animation = animated_histogram)
# Display the animation in RStudio
animated_histogram
